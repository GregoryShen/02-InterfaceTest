# [如何提高接口测试的效率](https://www.bilibili.com/video/BV13t411w7q4)





# [持续演进的接口自动化测试方案](https://mp.weixin.qq.com/s/ZHq3H4WfXb8jkpZWyUPWPQ)

## 前言

接口自动化基本上每个测试团队都会涉及，市面上大部分文章会从如何设计框架去讲解。这次想回归自动化的根本价值，从持续演进的解决方案出发。

## 价值

如何让接口自动化的价值最大化，首先需要想清楚如何去评估接口自动化的质量，具体包括：

1. 最大化提升回归测试的效率
2. 消灭更多的测试盲点

接下来介绍的持续演进的方案都是基于这两个方向去努力的

## 业务服务器架构

业务的服务器架构，接口自动化的测试目标：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/PfMGv3PxR7ib55KibTSQea0tKUCseEO2324LEiasOmiag6yyziaGbC4eibMwWL1mzfT8EeoZX9EPTYFSz1r2ZHgRhx2Q/640)

客户端：渠道较多，分 Web，H5，小程序，APP，Pad，通过 youzan.com 域名请求，统一接入到公司网关层 Nginx 集群，反向代理转发到对应业务的 Web 服务器。

* Web 服务器：这一层是 Nodejs 实现，涉及逻辑主要是路由转发、登录态校验
* 后端服务器：电商系通用的 Java 微服务架构，API1和API2是接入层，涉及逻辑主要是请求转发和非业务相关的通用处理。Service1 这一层才是真正的业务逻辑层，大概有30多个微服务应用，互相之间使用 dubbo 协议通信。

所以接口自动化面临2种选型：

1. 模拟客户端进行 HTTP 请求，优势是能快速覆盖用户场景，劣势是需要构建大量的数据，后期维护成本高。
2. 基于 dubbo 协议进行请求，优势是能 Mock 依赖数据，劣势是前期脚本编写成本高，且不支持预发执行。

最终是两者互相结合，扬长避短。

## 如何提升回归测试效率

这里需要从三个阶段来看：回归测试前、回归测试中、回归测试后。

回归测试前，我们通过2个事情来提升效率：

### 精准定位自动化测试覆盖范围

最原始的范围依据是根据功能测试用例来，但这不是客观合理的，我们从对外暴露的接口数和后端 Service 层应用的代码覆盖率去评估。

我们基于 Jacobo 进行二次开发实现增量代码覆盖率统计，可以拿到每次执行自动化后的指令级覆盖（Instructions，C0coverage），分支（Branches,C1coverage）,圈复杂度（Cyclomatic Complexity）,行覆盖（Lines），方法覆盖（non-abstract methods），类覆盖（classes）。通过这些信息我们可以对我们的自动化进行查漏补缺。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/PfMGv3PxR7ib55KibTSQea0tKUCseEO232sOCQd53jVhZmpDQKDOdD1VEib6TqW3eFZDRNq97VP10gsEfK0WL82QA/640)

通过解析前端路由文件，获取线上正在使用的接口数，作为基准，对比自动化执行请求的接口数，可以快速告诉各个模块负责人覆盖盲点。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/PfMGv3PxR7ib55KibTSQea0tKUCseEO232xy3CTuxPrpO0oOrmtN87fVmXnZmNZQEFtYbyHibHC69rx8Mbq3cHsvA/640)

### 高效编写自动化脚本

我们需要通过抓包工具来获取请求信息，

#### 延迟队列

#### 多级模块支持并发执行

#### 数据清理采用命令模式

## 消灭更多测试盲点

### 线上业务自动化校验

### 流量录制回放

